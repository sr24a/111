<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØµÙØ­Ø© Ø§Ù„ÙƒØ§Ø´ÙŠØ±</title>
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #2c2c2c;
            padding: 40px;
            color: #fff;
        }
        h1 {
            text-align: center;
            color: #f5c242;
        }
        .product-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        .product-card {
            background-color: #1c1c1c;
            padding: 20px;
            border-radius: 10px;
            flex: 1 1 calc(25% - 20px);
            box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.3);
            text-align: center;
            transition: transform 0.2s;
        }
        .product-card:hover {
            transform: translateY(-5px);
        }
        .product-card h3 {
            margin: 10px 0;
            color: #f5c242;
        }
        .product-card p {
            margin: 5px 0;
        }
        .add-to-cart {
            padding: 10px;
            background-color: #f5c242;
            color: #2c2c2c;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .add-to-cart:hover {
            background-color: #e5a823;
        }
        .cart {
            background-color: #1c1c1c;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 18px;
        }
        .checkout {
            display: block;
            margin-top: 20px;
            width: 100%;
            padding: 15px;
            background-color: #f5c242;
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .checkout:hover {
            background-color: #e5a823;
        }
        .discount-container {
            margin-top: 20px;
            text-align: center;
        }
        .discount-container input {
            padding: 10px;
            border-radius: 5px;
            border: none;
            background-color: #444;
            color: white;
            width: 80%;
            margin-bottom: 10px;
        }
        .discount-container button {
            padding: 10px 20px;
            background-color: #f5c242;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .discount-container button:hover {
            background-color: #e5a823;
        }
        .total-amount {
            text-align: center;
            margin-top: 10px;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <h1>ØµÙØ­Ø© Ø§Ù„ÙƒØ§Ø´ÙŠØ±</h1>

    <div class="product-container" id="productContainer"></div>

    <div class="cart">
        <h2>Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h2>
        <div id="cartItems"></div>
        <div class="total-amount" id="totalAmount">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0 Ø±ÙŠØ§Ù„</div>
    </div>

    <div class="discount-container">
        <h2>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ…</h2>
        <input type="number" id="discountInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø®ØµÙ… (%)" min="0" max="100">
        <button onclick="applyDiscount()">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ…</button>
    </div>

    <button class="checkout" onclick="checkout()">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹</button>
    <p id="totalBudget" style="text-align:center;">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©: 0 Ø±ÙŠØ§Ù„</p>

    <script>
        const cart = [];
        let totalAmount = 0; // Ø§Ù„Ù…ØªØºÙŠØ± Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ù…Ù† LocalStorage Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        function loadBudget() {
            const budget = localStorage.getItem('budget') || 0;
            document.getElementById('totalBudget').innerText = "Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©: " + budget + " Ø±ÙŠØ§Ù„";
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† LocalStorage Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        function loadProducts() {
            const products = JSON.parse(localStorage.getItem('products')) || [];
            const productContainer = document.getElementById('productContainer');
            productContainer.innerHTML = '';
            products.forEach((product, index) => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <h3>${product.name}</h3>
                    <p>Ø§Ù„Ø³Ø¹Ø±: ${product.price} Ø±ÙŠØ§Ù„</p>
                    <p>Ø§Ù„Ù…ØªÙˆÙØ±: ${product.stock}</p>
                    <button class="add-to-cart" onclick="addToCart(${index})">Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©</button>
                `;
                productContainer.appendChild(productCard);
            });
        }

        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©
        function addToCart(index) {
            const products = JSON.parse(localStorage.getItem('products')) || [];
            const product = products[index];
            if (product.stock > 0) {
                const existingCartItem = cart.find(item => item.name === product.name);
                if (existingCartItem) {
                    existingCartItem.quantity += 1; // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙƒÙ…ÙŠØ©
                } else {
                    cart.push({ name: product.name, quantity: 1 }); // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
                }
                product.stock -= 1; // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                localStorage.setItem('products', JSON.stringify(products));
                updateCart();
                loadProducts(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
            } else {
                alert('Ø¹Ø°Ø±Ù‹Ø§ØŒ Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªÙˆÙØ±.');
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ù„Ø©
        function updateCart() {
            const cartItemsDiv = document.getElementById('cartItems');
            cartItemsDiv.innerHTML = '';
            cart.forEach((item, index) => {
                const cartItemDiv = document.createElement('div');
                cartItemDiv.classList.add('cart-item');
                cartItemDiv.innerHTML = `
                    <span>${item.name} - Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.quantity}</span>
                    <button onclick="removeItem(${index})">ğŸ—‘</button>
                `;
                cartItemsDiv.appendChild(cartItemDiv);
            });
            calculateTotal(); // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
        }

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
        function calculateTotal() {
            totalAmount = cart.reduce((sum, item) => {
                const product = JSON.parse(localStorage.getItem('products')).find(p => p.name === item.name);
                return sum + (product.price * item.quantity);
            }, 0);
            document.getElementById('totalAmount').innerText = "Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: " + totalAmount + " Ø±ÙŠØ§Ù„";
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ…
        function applyDiscount() {
            const discountPercentage = parseFloat(document.getElementById('discountInput').value);
            if (!isNaN(discountPercentage) && discountPercentage >= 0 && discountPercentage <= 100) {
                const discountAmount = (totalAmount * (discountPercentage / 100));
                const discountedTotal = totalAmount - discountAmount;
                alert(`ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ…! Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…: ${discountedTotal} Ø±ÙŠØ§Ù„`);
                totalAmount = discountedTotal; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                document.getElementById('totalAmount').innerText = "Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: " + totalAmount + " Ø±ÙŠØ§Ù„"; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶
            } else {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Ø³Ø¨Ø© Ø®ØµÙ… ØµØ­ÙŠØ­Ø© Ù…Ù† 0 Ø¥Ù„Ù‰ 100.');
            }
        }

        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø³Ù„Ø©
        function removeItem(index) {
            const productName = cart[index].name;
            cart.splice(index, 1);
            const products = JSON.parse(localStorage.getItem('products')) || [];
            const product = products.find(p => p.name === productName);
            if (product) {
                product.stock += 1; // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
            }
            localStorage.setItem('products', JSON.stringify(products));
            updateCart();
            loadProducts(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        }

        // Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹
        function checkout() {
            if (cart.length === 0) {
                alert('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©.');
                return;
            }

            const products = JSON.parse(localStorage.getItem('products')) || [];
            const budget = parseFloat(localStorage.getItem('budget')) || 0;

            if (totalAmount <= budget) {
                alert(`ØªÙ… Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${totalAmount} Ø±ÙŠØ§Ù„`);
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©
                localStorage.setItem('budget', (budget + totalAmount)); // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©
                loadBudget(); // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©
                cart.length = 0; // ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©
                updateCart();
            } else {
                alert('Ø¹Ø°Ø±Ù‹Ø§ØŒ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© ØºÙŠØ± ÙƒØ§ÙÙŠØ©.');
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        window.onload = () => {
            loadProducts();
            loadBudget();
        };
    </script>
</body>
</html>
